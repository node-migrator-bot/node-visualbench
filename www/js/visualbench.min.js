/**
  Main function dealing with GUI elements and graphing
**/$(document).ready(function(){function a(b,c,d){var e=$("#"+b+"-template"),f=e.text().trim(),g=a[b]=a[b]||jade.compile(f);return d?e.after(g(c)):g(c)}function b(b){function h(){g=$.plot(f,[],e),k(b+".json")}function i(a,b,c){$('<div id="tooltip">'+c+"</div>").css({position:"absolute",top:b-15,left:a+15,padding:"2px"}).addClass("well").appendTo("body")}function k(c){console.log("Loading",c),$.ajax({url:"/data/"+c,dataType:"json",error:function(){console.log("ERROR",arguments)},success:function(c){var e=Object.keys(c),f={},h=RegExp("[\\.:]","g");e.forEach(function(a){f[a.replace(h,"_")]=a});var i=a("keys",{name:b,keys:f}),j=$("#"+b+"-keys");j.empty(),$(i).appendTo(j),Object.keys(f).forEach(function(a){$("#"+a+"-"+b+"-key").click(function(b){b.preventDefault();var e=f[a];g.setData(d(c[e])),g.setupGrid(),g.draw()})})}})}var e={series:{lines:{show:!0},points:{show:!0}},zoom:{interactive:!0},pan:{interactive:!0},grid:{hoverable:!0,clickable:!0}},f=$("#"+c(b)+"-graph"),g;h();var j=null;f.bind("plothover",function(a,c,d){if($("#"+b+"-showTooltip.active").length>0)if(d){if(j!=d.dataIndex){j=d.dataIndex,$("#tooltip").remove();var e=d.datapoint[0].toFixed(2),f=d.datapoint[1].toFixed(2);i(d.pageX,d.pageY,d.series.label+"("+e+")="+f)}}else $("#tooltip").remove(),j=null}),$("#"+b+"-controls .btn").each(function(a){$(this).click(function(b){b.preventDefault();switch(a){case 0:g.zoomOut();break;case 1:g.zoom();break;case 2:h();break;default:}})})}function c(a){return a.replace(RegExp("[^a-zA-Z0-9_\\-:\\.]","g"),"_")}function d(a){var b=[],c={};for(var d in a){c[d]||(c[d]=[]);var e=0,f=a[d];for(var g=0,h=f.length;g<h;g++)c[d].push([g,f[g]])}for(var d in c)b.push({label:d,data:c[d]});return b}$.ajax({url:"data",dataType:"json",success:function(d){function j(){h.toggleClass("subnav-fixed",g.scrollTop()>=i)}var e=d.map(function(a){return a.replace(/\.json/,"")}),f={files:e.map(c)};a("files",f,!0);var g=$(window),h=$(".subnav"),i=h.length&&h.offset().top-40;a("graph",f,!0),e.forEach(b)}})});